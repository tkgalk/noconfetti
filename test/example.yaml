# YAML Example - Configuration File
# Testing: comments, strings, numbers, booleans, arrays, objects, anchors

# Application Configuration
app:
  name: "User Management System"
  version: "1.0.0"
  api_version: v1
  description: |
    A comprehensive user management system
    with role-based access control and
    advanced reporting capabilities.

  # Server configuration
  server:
    host: localhost
    port: 8080
    ssl: true
    timeout: 30
    max_connections: 1000

    # TLS/SSL settings
    tls:
      enabled: true
      cert_file: /path/to/cert.pem
      key_file: /path/to/key.pem
      min_version: "1.2"
      ciphers:
        - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
        - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305

  # Database configuration
  database:
    driver: postgresql
    host: localhost
    port: 5432
    name: userdb
    username: dbuser
    password: "${DB_PASSWORD}" # Environment variable
    ssl_mode: require
    max_pool_size: 20
    min_pool_size: 5
    connection_timeout: 10
    idle_timeout: 300
    max_lifetime: 3600

  # Redis cache configuration
  cache:
    enabled: true
    driver: redis
    host: localhost
    port: 6379
    database: 0
    password: null
    ttl: 3600
    prefix: "app:"

# Logging configuration
logging:
  level: info
  format: json
  output: stdout

  # Log levels by module
  levels:
    app: debug
    database: info
    http: warn
    cache: error

  # File logging
  file:
    enabled: true
    path: /var/log/app/
    name: app.log
    max_size: 100 # MB
    max_age: 30 # days
    max_backups: 10
    compress: true

# Authentication configuration
auth:
  enabled: true
  providers:
    # Local authentication
    - name: local
      type: credentials
      enabled: true
      settings:
        bcrypt_cost: 12
        min_password_length: 8
        require_special_char: true
        require_number: true
        require_uppercase: true
        max_login_attempts: 5
        lockout_duration: 900 # seconds

    # OAuth2 providers
    - name: google
      type: oauth2
      enabled: true
      settings:
        client_id: "${GOOGLE_CLIENT_ID}"
        client_secret: "${GOOGLE_CLIENT_SECRET}"
        redirect_url: https://example.com/auth/google/callback
        scopes:
          - openid
          - profile
          - email

    - name: github
      type: oauth2
      enabled: false
      settings:
        client_id: "${GITHUB_CLIENT_ID}"
        client_secret: "${GITHUB_CLIENT_SECRET}"
        redirect_url: https://example.com/auth/github/callback
        scopes:
          - user:email
          - read:user

  # JWT settings
  jwt:
    secret: "${JWT_SECRET}"
    algorithm: HS256
    expiration: 3600 # seconds
    refresh_expiration: 2592000 # 30 days
    issuer: user-management-system
    audience: api

# User roles and permissions
roles:
  - name: admin
    description: Administrator with full access
    permissions:
      - "*" # All permissions

  - name: user
    description: Regular user with limited access
    permissions:
      - user:read
      - user:update:self
      - post:create
      - post:read
      - post:update:own
      - post:delete:own

  - name: guest
    description: Guest user with read-only access
    permissions:
      - user:read:public
      - post:read:public

# Email configuration
email:
  enabled: true
  provider: smtp

  smtp:
    host: smtp.gmail.com
    port: 587
    username: noreply@example.com
    password: "${EMAIL_PASSWORD}"
    from: "User Management System <noreply@example.com>"
    use_tls: true

  templates:
    welcome:
      subject: "Welcome to User Management System"
      template_file: templates/welcome.html

    password_reset:
      subject: "Password Reset Request"
      template_file: templates/password_reset.html

    verification:
      subject: "Verify Your Email"
      template_file: templates/verification.html

# Feature flags
features:
  user_registration: true
  email_verification: true
  two_factor_auth: false
  api_rate_limiting: true
  data_export: true
  advanced_search: false
  real_time_notifications: true

# API rate limiting
rate_limiting:
  enabled: true
  default_limit: 100
  window: 60 # seconds

  # Per-endpoint limits
  endpoints:
    /api/users:
      limit: 50
      window: 60

    /api/auth/login:
      limit: 5
      window: 300 # 5 attempts per 5 minutes

    /api/posts:
      limit: 200
      window: 60

# Monitoring and metrics
monitoring:
  enabled: true

  # Prometheus metrics
  prometheus:
    enabled: true
    port: 9090
    path: /metrics

  # Health check
  health_check:
    enabled: true
    path: /health
    interval: 30

  # Performance monitoring
  apm:
    enabled: false
    service_name: user-management
    environment: production

# Sample users for testing (using YAML anchors and aliases)
sample_users:
  - &alice
    id: 1
    name: Alice Johnson
    email: alice@example.com
    age: 28
    role: admin
    active: true
    created_at: 2024-01-15T10:30:00Z
    metadata:
      department: Engineering
      location: San Francisco
      timezone: America/Los_Angeles

  - &bob
    id: 2
    name: Bob Smith
    email: bob@example.com
    age: 17
    role: user
    active: true
    created_at: 2024-02-20T14:45:00Z
    metadata:
      department: null
      location: New York
      timezone: America/New_York

  - id: 3
    name: Charlie Brown
    email: charlie@example.com
    age: 45
    role: user
    active: false
    created_at: 2024-03-10T09:15:00Z
    metadata:
      department: Marketing
      location: London
      timezone: Europe/London

# Test configuration using aliases
test:
  admin_user: *alice
  regular_user: *bob

# Environment-specific overrides
environments:
  development:
    app:
      server:
        port: 3000
        ssl: false
    logging:
      level: debug
    database:
      name: userdb_dev

  staging:
    app:
      server:
        port: 8080
        ssl: true
    logging:
      level: info
    database:
      name: userdb_staging

  production:
    app:
      server:
        port: 443
        ssl: true
    logging:
      level: warn
    database:
      name: userdb_prod
      max_pool_size: 50

# Complex nested structures
notifications:
  channels:
    - type: email
      enabled: true
      recipients:
        - admin@example.com
        - ops@example.com
      events:
        - user_created
        - user_deleted
        - security_alert

    - type: slack
      enabled: true
      webhook_url: "${SLACK_WEBHOOK_URL}"
      channel: "#alerts"
      events:
        - error
        - critical
        - security_alert

    - type: sms
      enabled: false
      provider: twilio
      credentials:
        account_sid: "${TWILIO_ACCOUNT_SID}"
        auth_token: "${TWILIO_AUTH_TOKEN}"
      from: "+1234567890"
      events:
        - critical

# Scheduled tasks (cron-like)
scheduled_tasks:
  - name: cleanup_old_sessions
    schedule: "0 0 * * *" # Daily at midnight
    enabled: true

  - name: send_daily_report
    schedule: "0 9 * * 1-5" # Weekdays at 9 AM
    enabled: true
    recipients:
      - admin@example.com

  - name: backup_database
    schedule: "0 2 * * *" # Daily at 2 AM
    enabled: true
    retention_days: 30

# Integration configurations
integrations:
  analytics:
    google_analytics:
      enabled: true
      tracking_id: "${GA_TRACKING_ID}"

    mixpanel:
      enabled: false
      project_token: "${MIXPANEL_TOKEN}"

  payment:
    stripe:
      enabled: true
      public_key: "${STRIPE_PUBLIC_KEY}"
      secret_key: "${STRIPE_SECRET_KEY}"
      webhook_secret: "${STRIPE_WEBHOOK_SECRET}"

  storage:
    aws_s3:
      enabled: true
      region: us-west-2
      bucket: user-uploads
      access_key_id: "${AWS_ACCESS_KEY_ID}"
      secret_access_key: "${AWS_SECRET_ACCESS_KEY}"

# Multiline strings
legal:
  privacy_policy: >
    This is a privacy policy that can span
    multiple lines. Newlines are converted
    to spaces.

  terms_of_service: |
    These are the terms of service.
    Line breaks are preserved exactly.

    This is a new paragraph.

# Special values
special_values:
  null_value: null
  empty_string: ""
  boolean_true: true
  boolean_false: false
  integer: 42
  float: 3.14159
  scientific: 1.23e-4
  infinity: .inf
  not_a_number: .nan
  octal: 0o755
  hexadecimal: 0xFF
  binary: 0b1010

# Timestamps
timestamps:
  iso8601: 2024-01-15T10:30:00Z
  date_only: 2024-01-15
  canonical: 2024-01-15T10:30:00.123Z
